# نحوه‌ی کار 

-----
در مرحله‌ی اول این پروژه با گرفتن نام پکیج یک اپلیکیشن اندروید نسبت به دانلود آن اقدام می‌کند و آن را در پوشه‌ی output ذخیره می‌کند. مدل کاری آن به این صورت است که یک url به صورت `localhost:8001/analyse_apk?package_id={package_name}` فراخوانده می‌شود. برای این مرحله نیاز است که یک Rest Api Key که از سمت MobSF دریافت شده است در کد قرار داده شود.
در این مرحله‌ فایل مربوط به `download.py` استفاده می‌شود که در این فایل apk مربوط دانلود خواهد شد. سپس این فایل با استفاده از Rest Api مربوط به MobSF در آن آپلود شده و نسبت به شروع آنالیز اقدام می‌کند و هش مربوط به آنالیز و نام آن را در دیتابیس ذخیره می‌کند. در واقع هر پکیج می‌تواند دارای بیش از یک هش باشد.
بعد از اتمام آن کاربر به سمت url مربوط به دریافت pdf ریدایرکت می‌شود و فایل ریپویت pdf مربوط به آن آنالیز با استفاده از هش که از دیتابیس خوانده شده است در سیستم کاربر ذخیره شده و کاربر می‌تواند آن را مشاهده کند.
نمونه‌ی pdf مربوط به برنامه‌ی ماشین حساب گوگل در پوشه‌ی reports موجود است.

چرا برای دانلود از گوگل پلی به صورت مستقیم استفاده نکردیم؟
1. محدودیت جدید گوگل پلی روی `https://accounts.google.com/b/0/DisplayUnlockCaptcha` مشکل ساز شده است و نمی‌توان با اکانت گوگل به همراه کد به راحتی کار کرد
2. آخرین کدهای مربوط به دانلود مستقیم از گوگل پلی در گیت‌هاب مربوط به ۴ سال پیش است و ریسپانس مربوط به صفحات apk تغییر کرده است
3. apkها بر بستر S3 ذخیره می‌شود که استفاده از آن با توکن‌های لاگین فعلی امکان پذیر نیست.

به همین دلایل از یک mirror برای دانلود apkها استفاده شده است.

Dynamic Analysis:

برای آنالیز داینامیک پس از بالا آوردن mobosf ما نیاز داریم که یک امولاتور به آن متصل کنیم. ما برای این کار از genymotion استفاده کردیم. نکته مهم این است که mobosf فقط تا اندروید ۱۰ را ساپورت می‌کند پس یک موبایل با اندروید ۸.۱ روی آن ساختم و پس از آن خود mobosf به صورت خودکار حضور امولاتور را تشخیص داد و سپس ما وارد این صفحه شدیم.
![](./Screenshot%20from%202023-07-07%2022-59-40.png)
در این صفحه من چند سری تست ران کردم که نهایتا log-cat آن را در همین ریپازیتوری گیت قرار داده‌ام. همچنین اسکرین زیر تصویر حین اجرای یکی از تست هایم می‌باشد.
![](./Screenshot%20from%202023-07-07%2023-00-03.png)